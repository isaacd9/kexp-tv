<?xml version="1.0" encoding="utf-8" ?>
<component name="NowPlaying" extends="Scene">
	<children>
    <Overhang
      id="overhang"
      title="KEXP 90.3"
      logoUri="pkg:/images/logo-yellow.png"
      logoBaselineOffset="20"
      leftDividerUri=""
      leftDividerVertOffset="1000"
      clockText=""
      titleColor="0xAEAEAE"
      clockColor="0xAEAEAE"
      opacity=".65"
    />
    <LayoutGroup
      id="content"
      layoutDirection="vert"
      itemSpacings = "30"
      vertAlignment = "center"
      horizAlignment = "center"
    >
    <LayoutGroup
      id="maindisp"
      layoutDirection="horiz"
      itemSpacings = "30"
      vertAlignment = "top"
    >
    <Poster
      id="album_cover"
      width="500"
      height="500"
      uri="pkg:/images/default-album-art.png"
      translation="[0,0]" />
    <TrackDisplay id="trackDisplay" />
      </LayoutGroup>
    </LayoutGroup>
	</children>
<!-- BrightScript Portion -->
<script type="text/brightscript" >
<![CDATA[
  function init()
    overhang = m.top.findNode("overhang")
    m.top.backgroundUri = ""
    m.top.backgroundColor	= "0x111111"

    res = m.top.currentDesignResolution
    disp = m.top.findNode("content")
    disp.translation = [res.width / 2, res.height / 2]

    m.metadataTask = createObject("RoSGNode", "MetadataLoader")

    m.metadataTask.observeField("tracks", "updateTracks")
    m.metadataTask.observeField("album_art", "updateAlbumArt")
    m.metadataTask.observeField("show_info", "updateShow")

    m.metadataTask.control = "RUN"
  end function

  function updateTracks()
    disp = m.top.findNode("trackDisplay")
    disp.tracks = m.metadataTask.tracks
  end function

  function updateAlbumArt()
    album_art_node = m.top.findNode("album_cover")
    album_art_uri = m.metadataTask.album_art
    if album_art_uri = ""
      album_art_uri = "pkg:/images/default-album-art.png"
    end if
    album_art_node.uri = album_art_uri
  end function

  function updateShow()
    overhang = m.top.findNode("overhang")
    show_info = m.metadataTask.show_info
    overhang.clockText = show_info.program_name + " with " + show_info.host_names[0]
  end function
]]>
</script>
<!-- End of BrightScript Portion -->
</component>
